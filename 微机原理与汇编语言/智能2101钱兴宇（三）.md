###  第三次作业：阶乘

DATAS SEGMENT
  STRING DB 'PLEASE INPUT A NUMBER YOU WANT TO CALCULATE:',0DH,0AH,'$'
  ERROR DB 0DH,0AH,' THE NUMBER IS TOO BIG! ',0DH,0AH,'$'
  OUTSTR DB 0DH,0AH,'RESULT IS : $'
  A DW 10000 DUP (0),0
  ANUM DW 1
  CARRY DW 0
DATAS ENDS

CODES SEGMENT
  ASSUME CS:CODES,DS:DATAS
START:
  MOV AX,DATAS
  MOV DS,AX
  MOV DX,OFFSET STRING
  MOV AH,09H
  INT 21H
  CALL SHURU
  CMP BP,1000
  JBE MOK
  MOV DX,OFFSET ERROR
  MOV AH,9
  INT 21H
  JMP START
MOK:
	CALL FACTORIAL
	CALL SHUCHU
  MOV AX,4C00H
  INT 21H
SHURU PROC
	PUSH DX
	PUSH CX
	PUSH BX
	PUSH AX
	XOR BP,BP
	MOV BX,10
	MOV CX,5
INPUT:
	MOV AH,0
	INT 16H
	CMP AL,0DH
	JZ OK
	CMP AL,'0'
	JB INPUT
	CMP AL,'9'
	JA INPUT
	MOV AH,0EH
	INT 10H
	AND AX,000FH
	XCHG AX,BP
	MUL BX
	ADD BP,AX
	LOOP INPUT
OK:	NOP
	POP AX
	POP BX
	POP CX
	POP DX
	RET
SHURU ENDP

FACTORIAL PROC
	PUSH DX
	PUSH CX
	PUSH BX
	PUSH AX
	MOV AX,BP
	CMP BP,1
	JNZ BEGIN
	MOV A[0],AX
	POP AX
	POP BX
	POP CX
	POP DX
	RET
BEGIN:
	DEC BP
	CALL FACTORIAL
	MOV BX,1
AMUL:
	PUSH AX
	PUSH BX
	SHL BX,1
	MUL A[BX-2]
	POP BX
	ADD AX,CARRY
	MOV DX,0
	MOV CX,10
	DIV CX
	MOV CARRY,AX
	PUSH BX
	SHL BX,1
	MOV A[BX-2],DX
	POP BX
	POP AX
	CMP BX,ANUM
	JZ DCARRY
	INC BX
	JMP AMUL

DCARRY:
	PUSH AX
	CMP CARRY,0
	JZ DONE
	INC BX
	MOV AX,CARRY
	MOV DX,0
	MOV CX,10
	DIV CX
	PUSH BX
	SHL BX,1
	MOV A[BX-2],DX
	POP BX
	MOV CARRY,AX
	MOV CX,ANUM
	INC CX
	MOV ANUM,CX
	POP AX
	JMP DCARRY
DONE:
	POP AX
	POP AX
	POP BX
	POP CX
	POP DX
	RET
FACTORIAL ENDP

SHUCHU PROC
	MOV DX,OFFSET OUTSTR
	MOV AH,09H
	INT 21H
	MOV BX,ANUM
BEGINO:
	PUSH BX
	SHL BX,1
	MOV AX,A[BX-2]
	POP BX
	ADD AL,30H
	MOV DL,AL
	MOV AH,02H
	INT 21H
	CMP BX,1
	JZ ENDO
	DEC BX
	JMP BEGINO
ENDO: RET
SHUCHU ENDP

CODES ENDS
  END START