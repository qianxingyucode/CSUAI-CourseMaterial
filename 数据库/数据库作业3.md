4.1建表

```sql
CREATE DATABASE SPJ;
USE SPJ;    
CREATE TABLE S (
	SNO VARCHAR(5) PRIMARY KEY,
	SNAME VARCHAR(10) NOT NULL,
	STATUS INT NOT NULL,
	CITY VARCHAR(10) NOT NULL
)
CREATE TABLE P (
	PNO VARCHAR(5) PRIMARY KEY,
	PNAME VARCHAR(10) NOT NULL,
	COLOR VARCHAR(10) NOT NULL,
	WEIGHT INT NOT NULL
)
CREATE TABLE J (
	JNO VARCHAR(5) PRIMARY KEY,
	JNAME VARCHAR(10) NOT NULL,
	CITY VARCHAR(10) NOT NULL
)
CREATE TABLE SPJ (
	SNO VARCHAR(5),
	PNO VARCHAR(5) NOT NULL,
	JNO VARCHAR(5) NOT NULL,
	PRIMARY KEY (SNO, PNO, JNO),   /*SPJ表的主码是(SNO, PNO, JNO)，主码只能有一个，但主码的属性可以有多个，称为联合主码(键)*/
	FOREIGN KEY (SNO) REFERENCES S(SNO),    /* SNO是外码，被参照表是S*/
	FOREIGN KEY (PNO) REFERENCES P(PNO),    /* PNO是外码，被参照表是P*/
	FOREIGN KEY (JNO) REFERENCES J(JNO),    /* JNO是外码，被参照表是J*/
	QTY INT NOT NULL
)

```

4.2查询

```sql
SELECT DISTINCT SNO
FROM   SPJ
WHERE  JNO = 'J1';


SELECT DISTINCT SNO
FROM   SPJ
WHERE  JNO = 'J1' AND PNO = 'P1';



SELECT DISTINCT SNO
FROM   SPJ
WHERE  JNO = 'J1' AND PNO IN
						 ( SELECT PNO
						   FROM   P
						   WHERE  COLOR = '红');

SELECT JNO
FROM   J
WHERE  NOT EXISTS
     ( SELECT *
	   FROM   S,P,SPJ
	   WHERE SPJ.JNO = J.JNO
	     and SPJ.SNO = S.SNO
	     and SPJ.PNO = P.PNO
	     and S.CITY  = '天津'
	     and P.COLOR = '红');

SELECT * FROM J;  



SELECT *         
FROM   S,P,J,SPJ
WHERE SPJ.JNO = J.JNO
  and SPJ.SNO = S.SNO
  and SPJ.PNO = P.PNO
  and S.CITY  = '天津'
  and P.COLOR = '红';



SELECT DISTINCT PND
FROM SPJ
WHERE SNO = 'S1'
SELECT JNO FROM SPJ
WHERE PNO = 'P1' AND JNO IN
					(
                    SELECT JNO
                    FROM SPJ
                    WHERE PNO = 'P2' AND SNO = 'S1'
                    )
```

5.1

```sql
SELECT SNAME, CITY
FROM S;

```

5.2

```sql
SELECT PNAME, COLOR, WEIGHT
FROM P;

```

5.3

```
SELECT PNAME, COLOR, WEIGHT
FROM P;

```

5.4

```sql
SELECT PNAME, QTY
FROM SPJ, P
WHERE SPJ.PNO = P.PNO AND JNO = 'J2';

```

5.5

```sql
SELECT DISTINCT PNO
FROM SPJ, S
WHERE SPJ.SNO = S.SNO AND S.CITY = '上海';

```

5.6

```sql
SELECT DISTINCT JNAME
FROM J, SPJ, S
WHERE J.JNO = SPJ.JNO AND SPJ.SNO = S.SNO AND S.CITY = '上海';


```

5.7

```sql

SELECT JNO
FROM SPJ
WHERE JNO NOT IN
	  ( SELECT JNO
        FROM S, SPJ
        WHERE S.SNO = SPJ.SNO AND CITY = '天津');

SELECT DISTINCT JNO
FROM S, SPJ
WHERE S.SNO = SPJ.SNO AND CITY = '天津';    /*找出使用了天津产的工程号码*/

SELECT DISTINCT JNO FROM SPJ;   /*全部的JNO*/

```

5.8

```sql
UPDATE P
SET COLOR = '蓝'
WHERE COLOR = '红';

SELECT * FROM P;   /*打印P表出来看看*/


```

5.9

```sql

UPDATE SPJ
SET SNO = 'S3'
WHERE SNO = 'S5' AND PNO = 'P6' AND JNO = 'J4';

```

5.10

```sql
DELETE
FROM S
WHERE SNO = 'S2';

DELETE
FROM SPJ
WHERE SNO = 'S2';

SELECT * FROM S;
SELECT * FROM SPJ;

```

5.11

```sql

INSERT
INTO SPJ
VALUES ('S2', 'P4', 'J6', 200);

SELECT * FROM SPJ;

```

9.1

```sql
CREATE VIEW SANJIAN
AS 
SELECT SNO, PNO, QTY
FROM SPJ, J
WHERE SPJ.JNO = J.JNO AND JNAME = '三建';

SELECT SNO, PNO, QTY       /*打印出来康康*/
FROM SPJ, J
WHERE SPJ.JNO = J.JNO AND JNAME = '三建';
SELECT *
FROM SPJ, J
WHERE SPJ.JNO = J.JNO;

SELECT DISTINCT PNO, QTY
FROM SANJIAN;

SELECT PNO, QTY   /*不去重的作对比*/
FROM SANJIAN;

```

9.2

```sqlite

SELECT *
FROM SANJIAN
WHERE SNO = 'S1';

SELECT * FROM SANJIAN;     /*打印出整个视图参照*/



```

